<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width,initial-scale=1" name="viewport" />
    <title>Embedding Tabular Metadata in HTML</title>
    <script class="remove" src="../local-biblio.js"></script>
    <script class="remove" src="https://www.w3.org/Tools/respec/respec-w3c-common"></script>
    <script class="remove" src="../replace-ed-uris.js"></script>
    <script class="remove">
      var respecConfig = {
          localBiblio: localBibliography,
          specStatus: "ED",
          shortName: "csvw-html",
          //publishDate:  "2014-03-27",
          //previousPublishDate: "2015-04-16",
          //previousMaturity: "WD",
          //previousURI: "http://www.w3.org/TR/2015/WD-tabular-metadata-20150416/",
          edDraftURI: "http://w3c.github.io/csvw/html-note/",
          //testSuiteURI: "http://www.w3.org/2013/csvw/tests/",
          //implementationReportURI: "http://www.w3.org/2013/csvw/tests/reports/index.html",
          // lcEnd: "3000-01-01",
          //crEnd: "2015-10-30",
          editors: [{
            name: "Gregg Kellogg",
            url: "http://greggkellogg.net/",
            company: "Kellogg Associates",
            companyURL: "http://kellogg-assoc.com/",
            w3cid: "44770"
           }],
          wg: "CSV on the Web Working Group",
          wgURI: "http://www.w3.org/2013/csvw/",
          wgPublicList: "public-csv-wg",
          wgPatentURI: "http://www.w3.org/2004/01/pp-impl/68238/status",
          useExperimentalStyles: true,
          otherLinks: [{
            key: "Repository",
            data: [{
                value: "We are on Github",
                href: "https://github.com/w3c/csvw"
            }, {
                value: "File a bug",
                href: "https://github.com/w3c/csvw"
            }]
          }],
          inlineCSS: true,
          issueBase: "https://github.com/w3c/csvw/issues/",
          noIDLIn: true,
          noLegacyStyle: false
          };
    </script>
    <script class="remove">
    function escapeContent(doc, content) {
          var utils = require("core/utils");
    // perform transformations to make it render and prettier
      return utils.xmlEscape(content);
    }
    </script>
    <style>
      td, th { padding-left: 1em; padding-right: 1em; }
      tbody tr th { text-align: left; }
      ol.algorithm {
        counter-reset: numsection;
        list-style-type: none;
      }
      ol.algorithm > li {
        margin: 1em -1em;
        padding-right: 1em;
        text-indent: -1em;
      }
      ol.algorithm > li:before {
        font-weight: bold;
        counter-increment: numsection;
        content: counters(numsection, ".") " ";
      }
      ol.algorithm>li p, ol.algorithm>li div {text-indent: 0em}
      ol.algorithm>li>p:first-child {position: relative; display: inline;}
      pre {overflow: auto;}
      dd a.externalDFN, p a.externalDFN {border-bottom:  1px solid #99c; font-style: italic;}

      dl.typography dt { font-weight: normal}
      dl.typography dd { margin-bottom: 0.3em; margin-top: 0.2em;}
      dl.typography a.externalDFN { border-bottom:  1px solid #99c; font-style: italic; }
      /* Style script blocks to be visable */
      div.example script {
          display:block;
      }
      </style>
    </style>
  </head>
  <body>
    <section id="abstract">
      <p>The <cite><a href="http://w3c.github.io/csvw/syntax/">Model for Tabular Data and Metadata on the Web</a></cite> describes mechanisms for extracting metadata from CSV documents starting with either a <cite><a href="http://w3c.github.io/csvw/syntax/#dfn-tabular-data-file" class="externalDFN">tabular data file</a></cite>, or a metadata description. In the case of starting with a CSV document, a procedure is followed to locate metadata describing that CSV (see <cite><a href="http://w3c.github.io/csvw/syntax/#locating-metadata">Locating Metadata</a></cite> in [[!tabular-data-model]]). Alternatively, processing may begin with a metadata file directly, which references the <cite><a href="http://w3c.github.io/csvw/syntax/#dfn-tabular-data-file" class="externalDFN">tabular data file(s)</a></cite>. However, in some cases, it is preferred to publish datasets using HTML rather than starting with either CSV or metadata files.</p>
      <p>Secondly, tabular data is often contained within HTML in the form of <cite><a href="http://www.w3.org/TR/html5/tabular-data.html#tabular-data">HTML table elements</a></cite> (see [[!html5]]). This document describes a means of identifying such tables from [[!tabular-metadata]] and extracting annotated tabular data from HTML tables.</p>
    </section>
    <section id="sotd">
      <p>
        The <a href="http://www.w3.org/2013/csvw">CSV on the Web Working Group</a> was <a href="http://www.w3.org/2013/05/lcsv-charter.html">chartered</a> to produce a recommendation "Access methods for CSV Metadata" as well as recommendations for "Metadata vocabulary for CSV data" and "Mapping mechanism to transforming CSV into various formats (e.g., RDF, JSON, or XML)". This non-normative document describes extensions for discovering [[!tabular-metadata]] within HTML documents, and for extracting <cite><a href="http://w3c.github.io/csvw/syntax/#dfn-annotated-table" class="externalDFN">annotated tables</a></cite> from HTML tables. The normative standards are:
      </p>
      <ul>
        <li><a href="http://w3c.github.io/csvw/syntax/">Model for Tabular Data and Metadata on the Web</a></li>
        <li><a href="http://w3c.github.io/csvw/metadata/">Metadata Vocabulary for Tabular Data</a></li>
        <li><a href="http://w3c.github.io/csvw/csv2json/">Generating JSON from Tabular Data on the Web</a></li>
        <li><a href="http://w3c.github.io/csvw/csv2rdf/">Generating RDF from Tabular Data on the Web</a></li>
      </ul>
    </section>
    <section>
      <h2>Embedding Tabular Metadata within HTML Documents</h2>
      <p class="ednote">This section describes a mechanism similar to <a href="http://www.w3.org/TR/json-ld/#embedding-json-ld-in-html-documents">Embedding JSON-LD in HTML Documents</a> (see [[json-ld]]).</p>
      <p>HTML <code>script</code> tags can be used to embed data blocks in documents (see <cite><a href="http://www.w3.org/TR/html5/scripting-1.html#scripting-1">Scripting</a></cite> in [[!html5]]). Metadata [[!tabular-metadata]] describing one or more <cite><a href="http://w3c.github.io/csvw/syntax/#dfn-tabular-data-file" class="externalDFN">tabular data files</a></cite> can embedded in HTML, which can be used as an alternative way to publish datasets.</p>
      <p>The content should be placed in a <code>script</code> tag with the <code>type</code> set to <code>application/csvm+json</code>. The character encoding of the embedded metadata will match the HTML documents encoding.</p>
    <pre class="example highlight" title="Tabular Meatadata embedded in HTML">
      &lt;html&gt;
        &lt;head&gt;
          &lt;script type=&quot;application/csvm+json&quot;&gt;
          {
            &quot;@context&quot;: &quot;http://www.w3.org/ns/csvw&quot;,
            &quot;tables&quot;: [{
              &quot;url&quot;: &quot;countries.csv&quot;,
              &quot;tableSchema&quot;: {
                &quot;columns&quot;: [{
                  &quot;name&quot;: &quot;countryCode&quot;,
                  &quot;titles&quot;: &quot;countryCode&quot;,
                  &quot;datatype&quot;: &quot;string&quot;,
                  &quot;propertyUrl&quot;: &quot;http://www.geonames.org/ontology{#_name}&quot;
                }, {
                  &quot;name&quot;: &quot;latitude&quot;,
                  &quot;titles&quot;: &quot;latitude&quot;,
                  &quot;datatype&quot;: &quot;number&quot;
                }, {
                  &quot;name&quot;: &quot;longitude&quot;,
                  &quot;titles&quot;: &quot;longitude&quot;,
                  &quot;datatype&quot;: &quot;number&quot;
                }, {
                  &quot;name&quot;: &quot;name&quot;,
                  &quot;titles&quot;: &quot;name&quot;,
                  &quot;datatype&quot;: &quot;string&quot;
                }],
                &quot;aboutUrl&quot;: &quot;countries.csv{#countryCode}&quot;,
                &quot;propertyUrl&quot;: &quot;http://schema.org/{_name}&quot;,
                &quot;primaryKey&quot;: &quot;countryCode&quot;
              }
            }, {
              &quot;url&quot;: &quot;country_slice.csv&quot;,
              &quot;tableSchema&quot;: {
                &quot;columns&quot;: [{
                  &quot;name&quot;: &quot;countryRef&quot;,
                  &quot;titles&quot;: &quot;countryRef&quot;,
                  &quot;valueUrl&quot;: &quot;countries.csv{#countryRef}&quot;
                }, {
                  &quot;name&quot;: &quot;year&quot;,
                  &quot;titles&quot;: &quot;year&quot;,
                  &quot;datatype&quot;: &quot;gYear&quot;
                }, {
                  &quot;name&quot;: &quot;population&quot;,
                  &quot;titles&quot;: &quot;population&quot;,
                  &quot;datatype&quot;: &quot;integer&quot;
                }],
                &quot;foreignKeys&quot;: [{
                  &quot;columnReference&quot;: &quot;countryRef&quot;,
                  &quot;reference&quot;: {
                    &quot;resource&quot;: &quot;countries.csv&quot;,
                    &quot;columnReference&quot;: &quot;countryCode&quot;
                  }
                }]
              }
            }]
          }
          &lt;/script&gt;
          ...
        &lt;/head&gt;
        &lt;body&gt;
          ...
        &lt;/body&gt;
      &lt;/html&gt;
    </pre>
    <p>Depending on how the HTML document is served, certain strings may need to be escaped.</p>
    <p>Processing embedded metadata is the same as processing <cite><a href="http://w3c.github.io/csvw/syntax/#overriding-metadata">Overriding Metadata</a></cite> where the retrieved document type is <code>text/html</code> or <code>application/xhtml+xml</code> instead of a JSON document type. The extracted metadata is processed using the location of the HTML document as base URL of the metadata document, except that the metadata is first extracted from each <code>script</code> element having <code>@type</code> <code>application/csvm+json</code>. Metadata documents parsed from an HTML DOM will be a stream of character data rather than a stream of UTF-8 encoded bytes. No decoding is necessary if the HTML document has already been parsed into DOM. Each matching <code>script</code> data block is considered to be it's own metadata document.</p>
    <p>To aid processors not including an HTML tool chain, HTML documents including metadata within a <code>script</code> element should also provide the location of a native JSON version of the metadata using a Link header using the equivalent mechanism described for CSV files by <cite><a href="http://w3c.github.io/csvw/syntax/#link-header" class="sectionRef">Link Header</a></cite> in [[!tabular-data-model]].</p>
    </section>
    <section>
      <h2>Extracting Tabular Data from HTML Tables</h2>
      <p>This section describes a mechanism for locating tabular data within an HTML document, extracting tabular data from an identified <cite><a href="http://www.w3.org/TR/html5/tabular-data.html#tabular-data">table element</a></cite>, and processing the tabular data to create <cite><a href="http://w3c.github.io/csvw/syntax/#dfn-annotated-table" class="externalDFN">annotated tables</a></cite>.</p>
      <p>The metadata describing HTML tables MUST be contained within a <code>script</code> element within the same document. Each <a href="http://w3c.github.io/csvw/syntax/#dfn-table-id" class="externalDFN">table id</a> MUST reference either an external tabular data file, or an HTML table within the same HTML document.</p>
      <p class="issue">There is no technical reason why an external metadata file cannot reference HTML tables from different HTML files, or an embedded metadata file cannot reference HTML tables from other HTML documents.</p>
      <p>A reference within an HTML document is described using a document-relative <em>fragment identifier</em> which is defined using the <code>@id</code> attribute on an <cite><a href="http://www.w3.org/TR/html5/tabular-data.html#tabular-data">HTML table element</a></cite>.</p>
      <p>Consideration must be given to the generation of URLs. The standard forms of both JSON [[csv2json]] and RDF [[csv2rdf]] both generate URLs by appending a fragment identifier to the table URL to identify rows. Also, unless an explicit <a href="http://w3c.github.io/csvw/syntax/#dfn-cell-property-url" class="externalDFN">propertyUrl</a> is defined, RDF properties are also generated using a fragment of the table URL.</p>
      <div class="practice">
        <p><span class="practicelab">Avoid automatically generated URLs</span></p>
        <p class="practicedesc">Explicitly define <a href="http://w3c.github.io/csvw/syntax/#dfn-cell-about-url" class="externalDFN">aboutUrl</a>, <a href="http://w3c.github.io/csvw/syntax/#dfn-cell-property-url" class="externalDFN">propertyUrl</a>, and <a href="http://w3c.github.io/csvw/syntax/#dfn-cell-value-url" class="externalDFN">valueUrl</a>, where appropriate, to avoid using automatically generated URL fragments which conflict with using fragments to identify tables.</p>
      </div>

      <section>
        <h3>Extracting HTML Tables</h3>
        <p>Raw tabular data may be extracted from HTML tables with use of the <a href="http://w3c.github.io/csvw/metadata/#dfn-dialect-description" class="externalDFN">dialect description</a> as with CSV tables.</p>
        <ul>
          <li><p>Table rows are numbered starting from <code>1</code>, as with CSV files.</p></li>
          <li><p>The in scope <a href="http://www.w3.org/TR/html5/dom.html#language" class="externalDFN">language</a> of the table element is used as the <a href="http://w3c.github.io/csvw/metadata/#cell-language">lang</a> inherited property for <a href="http://w3c.github.io/csvw/syntax/#dfn-embedding-metadata" class="externalDFN">embedded metadata</a>.</p></li>
          <li><p>Rows containing only <code>th</code> elements have their <a href="http://www.w3.org/TR/html5/infrastructure.html#textcontent" class="externalDFN">text content</a> used as the <a href="http://w3c.github.io/csvw/syntax/#dfn-column-titles" class="externalDFN">column titles</a> in the <a href="http://w3c.github.io/csvw/syntax/#dfn-embedding-metadata" class="externalDFN">embedded metadata</a>.</p></li>
          <li><p>Rows containing only <code>td</code> are used as <a href="http://w3c.github.io/csvw/syntax/#dfn-row-content" class="externalDFN">row content</a> with the <a href="http://www.w3.org/TR/html5/infrastructure.html#textcontent" class="externalDFN">text content</a> of each <code>td</code> element used as the <a href="http://w3c.github.io/csvw/syntax/#dfn-cell-string-value" class="externalDFN">cell string value</a>.</p></li>
        </ul>
        <p>Processing extracted tables is otherwise handled in a similar manner to CSV as defined in <cite><a href="http://w3c.github.io/csvw/syntax/#parsing">Parsing Tabular Data</a></cite> in [[!tabular-data-model]].</p>

      <div class="practice">
        <p><span class="practicelab">Header rows proceed content rows</span></p>
        <p class="practicedesc">Tables should be organized with the first rows containing only <code>th</code> elements to describe column headers. Subsequent rows should contain only <code>td</code> elements to describe table data.</p>
      </div>
      </section>
      <section>
        <h3>Example</h3>
        <p>The following tables are identified using <a href="#countries"><code>#countries</code></a> and <a href="#country_slice"><code>#country_slice</code></a>:</p>
        <table id="countries">
          <caption>Countries</caption>
          <tr><th>countryCode</th><th>latitude</th><th>longitude</th><th>name</th></tr>
          <tr><td>AD</td><td>42.5</td><td>1.6</td><td>Andorra</td></tr>
          <tr><td>AE</td><td>23.4</td><td>53.8</td><td>United Arab Emirates</td></tr>
          <tr><td>AF</td><td>33.9</td><td>67.7</td><td>Afghanistan</td></tr>
        </table>
        <table id="country_slice">
          <caption>Countries</caption>
          <tr><th>countryRef</th><th>year</th><th>population</th></tr>
          <tr><td>AF</td><td>1960</td><td>9616353</td></tr>
          <tr><td>AF</td><td>1961</td><td>9799379</td></tr>
          <tr><td>AF</td><td>1962</td><td>9989846</td></tr>
        </table>
        <pre class="example highlight"
             title="Referenced HTML tables"
             data-transform="escapeContent">
          <table id="countries">
            <caption>Countries</caption>
            <tr><th>countryCode</th><th>latitude</th><th>longitude</th><th>name</th></tr>
            <tr><td>AD</td><td>42.5</td><td>1.6</td><td>Andorra</td></tr>
            <tr><td>AE</td><td>23.4</td><td>53.8</td><td>United Arab Emirates</td></tr>
            <tr><td>AF</td><td>33.9</td><td>67.7</td><td>Afghanistan</td></tr>
          </table>
          <table id="country_slice">
            <caption>Country Slice</caption>
            <tr><th>countryRef</th><th>year</th><th>population</th></tr>
            <tr><td>AF</td><td>1960</td><td>9616353</td></tr>
            <tr><td>AF</td><td>1961</td><td>9799379</td></tr>
            <tr><td>AF</td><td>1962</td><td>9989846</td></tr>
          </table>
        </pre>
        <p>The metadata is describe here in a script element:</p>
        <pre class="example">
          <script type="application/csvm+json">
          {
            "@context": "http://www.w3.org/ns/csvw",
            "tables": [{
              "url": "#countries",
              "tableSchema": {
                "columns": [{
                  "name": "countryCode",
                  "titles": "countryCode",
                  "datatype": "string",
                  "propertyUrl": "http://www.geonames.org/ontology{#_name}"
                }, {
                  "name": "latitude",
                  "titles": "latitude",
                  "datatype": "number"
                }, {
                  "name": "longitude",
                  "titles": "longitude",
                  "datatype": "number"
                }, {
                  "name": "name",
                  "titles": "name",
                  "datatype": "string"
                }],
                "aboutUrl": "http://example.org/#countries-{countryCode}",
                "propertyUrl": "http://schema.org/{_name}",
                "primaryKey": "countryCode"
              }
            }, {
              "url": "#country_slice",
              "tableSchema": {
                "columns": [{
                  "name": "countryRef",
                  "titles": "countryRef",
                  "propertyUrl": "http://dbpedia.org/ontology/locationCountry",
                  "valueUrl": "http://example.org/#countries-{countryRef}"
                }, {
                  "name": "year",
                  "titles": "year",
                  "propertyUrl": "http://dbpedia.org/property/urbanAreaDate",
                  "datatype": "gYear"
                }, {
                  "name": "population",
                  "titles": "population",
                  "propertyUrl": "http://www.geonames.org/ontology/population",
                  "datatype": "integer"
                }],
                "foreignKeys": [{
                  "columnReference": "countryRef",
                  "reference": {
                    "resource": "#countries",
                    "columnReference": "countryCode"
                  }
                }]
              }
            }]
          }
          </script>
        </pre>
        <p>Generating Minimal JSON from this document should result in the following:</p>
        <pre class="example"
             title="Minimal JSON output"
             data-include="countries_embed-minimal.json"
             data-oninclude="escapeContent">
        </pre>
        <p>Generating Minimal RDF from this document should result in the following:</p>
        <pre class="example"
             title="Minimal RDF output"
             data-include="countries_embed-minimal.ttl"
             data-oninclude="escapeContent">
        </pre>
      </section>
  </body>
</html>

