<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <title>Generating RDF from Tabular Data on the Web</title>
    <script class="remove" src="https://www.w3.org/Tools/respec/respec-w3c-common">
	  </script>
    <script class="remove">
var respecConfig = {
    localBiblio: {
      "tabular-data-model": {
          "authors": [
            "Jeni Tennison",
            "Gregg Kellogg"
          ],
          "title": "Model for Tabular Data and Metadata on the Web",
          "href" : "http://www.w3.org/TR/tabular-data-model/",
          "rawDate": "2015-01-08",
          "status" : "WD",
          "publisher": "W3C"
      },
      "tabular-metadata": {
          "authors": [
            "Rufus Pollock",
            "Jeni Tennison",
            "Gregg Kellogg"
          ],
          "title": "Metadata Vocabulary for Tabular Data",
          "href" : "http://www.w3.org/TR/tabular-metadata/",
          "rawDate": "2015-01-08",
          "status" : "WD",
          "publisher": "W3C"
      },
      "UNICODE-BIDI" : {
        "authors" : [
          "Mark Davis",
          "Aharon Lanin",
          "Andrew Glass"
        ],
        "title": "TR9, Unicode Bidirectional Algorithm",
        "href": "http://unicode.org/reports/tr9/",
        "rawDate" : "2013-09-24",
        "publisher" : "Unicode Consortium",
        "status" : "Report"
      },
      "rfc6570" : {
          "authors" : [
            "J. Gregorio",
            "R. Fielding",
            "M. Hadley",
            "M. Nottingham",
            "D. Orchard"
          ],
          "title" : "URI Template",
          "rawDate" : "2002-01",
          "status": "Proposed Internet RFC",
          "publisher" : "IETF",
          "href" : "http://www.ietf.org/rfc/rfc6570.txt"
      }, 
      "iso8601" : {
          "title" : "ISO 8601:2004 Representation of dates and times",
          "rawDate" : "2004",
          "status": "International Standard (IS)",
          "publisher" : "ISO (International Organization for Standardization)"
      }, 
      "tr35" : {
        "authors" : [
          "Mark Davis",
          "CLDR committee members"
        ],
        "title": "TR35, Unicode Locale Data Markup Language (LDML)",
        "href": "http://unicode.org/reports/tr35/",
        "rawDate" : "2014-09-17",
        "publisher" : "Unicode Consortium",
        "status" : "Report"
      }


    },
    doRdfa: true,
    specStatus: "ED",
    shortName: "csv2rdf",
    // publishDate:  "2014-04-01",
    previousPublishDate: "2014-01-08",
    previousMaturity: "FPWD",
    previousURI: "http://www.w3.org/TR/2015/WD-csv2rdf-20150108/",
    edDraftURI: "http://w3c.github.io/csvw/csv2rdf/",
    // lcEnd: "3000-01-01",
    // crEnd: "3000-01-01",
    editors:
     [{
            name: "Jeremy Tandy",
            company: "Met Office",
            companyURL: "http://www.metoffice.gov.uk/"
      },
      {
       name: "Ivan Herman",
       url: "http://www.w3.org/People/Ivan",
       company: "W3C",
       companyURL: "http://www.w3.org"
     }],
    wg: "CSV on the Web Working Group",
    wgURI: "http://www.w3.org/2013/csvw/",
    wgPublicList: "public-csv-wg",
    wgPatentURI: "http://www.w3.org/2004/01/pp-impl/68238/status",
    otherLinks: [{
      key: "Repository",
      data: [{
          value: "We are on Github",
          href: "https://github.com/w3c/csvw/"
        }, {
          value: "File a bug",
          href: "https://github.com/w3c/csvw/issues"
        }]
      }, 
      {
        key: "Changes",
        data: [{
        //     value: "Diff to previous version",
        //     href: "diff-20140327.html"
        //   }, {}
           value: "Commit history",
           href: "https://github.com/w3c/csvw/commits/gh-pages"
         }]
       }] ,
    inlineCSS: true,
    noIDLIn: true,
    issueBase: "https://github.com/w3c/csvw/issues/",
    noLegacyStyle: false
    };
    </script>
    <style type="text/css">
      .grammar td { font-family: monospace; vertical-align: top; }
      .grammar-literal { color: gray;}
      .TBD { font-style: italic; background: yellow;}
      .steps li { margin-bottom: 0.5em;}
      table, td, th { border: 1px solid gray }
      dl.triple { padding: 0 0 0 1em; }
      dl.triple dt, dl.triple dd { margin: 0; display: inline }
      dl.triple dt:after { content: ':'; }
      dl.triple dd:after { content: '\A'; white-space: pre; }
    </style>
  </head>
  <body>
    <section id="abstract">
      <p>This document defines the procedures and rules to be applied when mapping 
        tabular data into RDF. Tabular data may be complemented with metadata 
        annotations that describe its structure, the meaning of its content and how 
        it may form part of a collection of interrelated tabular data. This document 
        specifies the effect of this metadata on the resulting RDF.</p>
   
    </section>
    
    <section id="sotd">
      <p>The CSV on the Web Working Group was chartered to produce Recommendations 
        for "Access methods for CSV Metadata", "Metadata vocabulary for CSV data" and 
        "Mapping mechanism to transforming CSV into various Formats (e.g., RDF, JSON, 
        or XML)". This document aims to satisfy the RDF variant of the mapping 
        Recommendation.</p>
    
      <p>Due to the limited resources available within the CSV on the Web Working Group,
        this document describes only a <em>simple mapping</em>â€”that is, where each 
        row of tabular data describes a single resource and a single RDF triple is created
        per cell. The Working Group solicits input on the value of mapping a single row
        of tabular data into multiple inter-related resources.</p>
   
    </section>

    <section id="intro">
      <h2>Introduction</h2>

      <p>This document describes the processing of 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-tabular-data" class="externalDFN">tabular data</a>
        to create an RDF graph comprising subject-predicate-object triples [[!rdf11-concepts]] referred to as the 
        <dfn>output graph</dfn>. Since RDF is an <em>abstract syntax</em>, 
        the <a>output graph</a> MUST be serialized in a <em>concrete RDF
        syntax</em> such as N-Triples [[n-triples]], Turtle [[turtle]], RDFa [[rdfa-primer]], JSON-LD [[json-ld]] or
        TriG [[trig]].</p>

      <p> 
        The Tabular Data Model [[!tabular-data-model]] defines a 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-core-tabular-data-model" class="externalDFN">
        core tabular data model</a> consisting of 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-table" class="externalDFN">tables</a>, 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-column" class="externalDFN">columns</a>,
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-row" class="externalDFN">rows</a> and 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-cell" class="externalDFN">cells</a>.</p>

      <p>Tabular data may be enriched with metadata that describes its structure and
        the meaning of its content. These metadata <em>annotations</em> are described 
        in [[!tabular-metadata]] and may be embedded within the CSV encoding itself as a
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-header-line" class="externalDFN">header line</a>
        or provided within a separate metadata document. The resulting 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-annotated-table" class="externalDFN">annotated 
        table</a> conforms to the 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-annotated-tabular-data-model" class="externalDFN">
        annotated tabular data model</a>.

      <p>The metadata annotations may describe how a 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-table" class="externalDFN">table</a> relates to a 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-group-of-tables" class="externalDFN">
        group of tables</a>. Such collections conform to the 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-grouped-tabular-data-model" class="externalDFN">
        grouped tabular data model</a>.</p>

      <p>The mapping procedure operates on the <em>abstract</em> tabular data model; 
        <em>core</em>, <em>annotated</em> or <em>grouped</em>. No discussion is given to 
        the processes needed to convert CSV-encoded data into tabular data form. Please 
        refer to [[!tabular-data-model]] for details of 
        <a href="http://www.w3.org/TR/tabular-data-model/#parsing">parsing tabular data</a>. 
        Further details on <a href="http://www.w3.org/TR/tabular-metadata/#parsing-cells">
        parsing cells</a> within tabular data is provided in [[!tabular-metadata]].</p>

      <div class="note">
        <p>Adopting terminology from the Data Catalog Vocabulary [[vocab-dcat]], the
          tabular data is considered to be a <em>dataset</em>, whilst the CSV file within
          which that tabular data is encoded is considered to be a <em>distribution</em> 
          of that tabular data.</p>
      </div>

      <div class="note">
        <p>An 
          <a href="http://www.w3.org/TR/tabular-data-model/#dfn-annotated-table" class="externalDFN">annotated 
          table</a> may include a reference to a
          <a href="http://www.w3.org/TR/tabular-data-model/#dfn-template-specification" class="externalDFN">
          template specification</a> (see [[!tabular-metadata]]) that describes how tabular
          data can be transformed into another format using a template-based approach.</p>
      </div>
      
      <p>Finally, note that the mapping procedure is considered to be <em>entirely textual</em>. 
        There is no requirement on compliant mapping applications to check the semantic
        consistency of the data during the mapping, nor validate the 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-cell-value" class="externalDFN">cell values</a> against
        RDF syntax rules. Where cell values within CSV encoded content are improperly formatted, 
        the output from the mapping is likely to include syntax errors. Downstream applications 
        should be aware of this and take appropriate action.</p>
      
    </section>
    
    <section id="conformance">
      <p><a href="http://www.w3.org/TR/tabular-data-model/#dfn-tabular-data" class="externalDFN">Tabular data</a> 
        MUST conform to the description from [[!tabular-data-model]]. In particular note
        that each row MUST contain the same number of cells (although some of these cells 
        may be empty). Given this constraint, not all CSV-encoded data can be considered 
        to be tabular data. As such, the procedures and rules defined in this document  
        cannot be applied to all CSV files.</p>
     
      <p>This document relies on terms (e.g. group, table, column, row, cell) defined in 
        [[!tabular-data-model]].</p>

      <p>This specification makes use of the <dfn title="CURIE">CURIE Syntax</dfn> for describing RDF
        Triples; see, for example, the <a href="http://www.w3.org/TR/rdfa-core/#s_curies">CURIE
          Syntax Definition Section</a> of the RDFa 1.1 Core Specification
        [[!rdfa-core]].</p>
     
      <p>This specification makes use of the following namespaces:</p>
      <dl>
        <dt><code>csvw</code>:</dt>
        <dd><code>http://www.w3.org/ns/csvw#</code></dd>
        <dt><code>rdf</code>:</dt>
        <dd><code>http://www.w3.org/1999/02/22-rdf-syntax-ns#</code></dd>
        <dt><code>rdfs</code>:</dt>
        <dd><code>http://www.w3.org/2000/01/rdf-schema#</code></dd>
        <dt><code>xsd</code>:</dt>
        <dd><code>http://www.w3.org/2001/XMLSchema#</code></dd>
        <dt><code>dc</code>:</dt>
        <dd><code>http://purl.org/dc/terms/</code></dd>
        <dt><code>dcat</code>:</dt>
        <dd><code>http://www.w3.org/ns/dcat#</code></dd>
        <dt><code>prov</code>:</dt>
        <dd><code>http://www.w3.org/ns/prov#</code></dd>
      </dl>
   
    </section>


    <section id="map-annotated-tab">
      <h2>Mapping Annotated Tabular Data</h2>

      <p>The procedures and rules for mapping annotated tabular data compliant with the
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-annotated-tabular-data-model" class="externalDFN">
        annotated tabular data model</a> are described below.</p>
      tableSchema
      <p>The metadata for annotated tabular data MAY be provided by either or both
        of the following sources:</p>
      <ul>
        <li>the <a href="http://www.w3.org/TR/tabular-data-model/#dfn-header-line" class="externalDFN">
          header line</a> within the CSV file; and/or</li>
        <li>the <a href="http://www.w3.org/TR/tabular-metadata/#dfn-table-description" class="externalDFN">
          table description</a>, 
          <a href="http://www.w3.org/TR/tabular-metadata/#dfn-tableSchema" class="externalDFN">tableSchema</a> and 
          <a href="http://www.w3.org/TR/tabular-metadata/#dfn-column-description" class="externalDFN">
          column descriptions</a> (as defined in [[!tabular-metadata]]) within the 
          associated metadata document.</li>
      </ul>

      <p>Mapping applications SHALL establish a 
        <a title="column description object">column description object</a> for each
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-column" class="externalDFN">column</a> within
        the annotated tabular data. The <dfn>column description object</dfn> contains the aggregated set
        of metadata properties for a given column that affect how the 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-cell-value" class="externalDFN">cell values</a>
        within the associated column are expressed in the <a>
        output graph</a>. Metadata properties are sourced from the 
        <a href="http://www.w3.org/TR/tabular-data-model/#dfn-header-line" class="externalDFN">header line</a>
        in the CSV file and <a href="http://www.w3.org/TR/tabular-metadata/#dfn-column-description" class="externalDFN">
        column description</a> in the metadata document and enriched with 
        <a href="http://www.w3.org/TR/tabular-metadata/#dfn-inherited-property" class="externalDFN">
        inherited properties</a> from the 
        <a href="http://www.w3.org/TR/tabular-metadata/#dfn-table-description" class="externalDFN">
        table description</a> and  
        <a href="http://www.w3.org/TR/tabular-metadata/#dfn-tableSchema" class="externalDFN">tableSchema</a>.</p>
      
      <p>The <a>output graph</a> MAY include 
        <a href="http://www.w3.org/TR/tabular-metadata/#dfn-direct-annotation" class="externalDFN">Direct Annotations</a>
        sourced from the metadata document as <a>Common Properties</a>.</p>
      <p class="note">Essentially, the direct annotations can be considered as the result of extracting the <a>common properties</a> from the metadata and running the JSON-LD toRdf algorithm to extract RDF triples. As there are no <a>common properties</a> which are natural language properties at present, this mechanism is sufficient to handle all forms of common property values.</p>

      <p class="issue">The Metadata document should provide access rules for retrieving
        properties considering column language and the base URL.</p>

      <p>URL expansion behaviour of relative URLs SHALL be consistent with
        <a href="http://www.w3.org/TR/json-ld-api/#iri-expansion">Section 6.3 IRI Expansion</a> 
        in [[!json-ld-api]]. The <dfn title="baseURL">base URL</dfn> provides the URL against 
        which relative URLs from annotated tabular data are resolved. The 
        <a title="baseURL">base URL</a> SHALL be that of the source CSV file.</p>  

      <section>
        <h3>Algorithm Terms</h3>
        <dl>
          <dt><dfn>annotated table</dfn></dt><dd>
            The <a href="http://www.w3.org/TR/tabular-data-model/#dfn-annotated-table" class="externalDFN">annotated table</a>
            is defined in [[!tabular-data-model]] as describing a particular
            <a href="http://www.w3.org/TR/tabular-data-model/#dfn-table-description" class="externalDFN">table</a>
            and its metadata.
          </dd>
          <dt><dfn>table group description</dfn></dt><dd>
            The <a href="http://www.w3.org/TR/tabular-metadata/#dfn-table-group-description" class="externalDFN">table group</a>
            <a href="http://www.w3.org/TR/tabular-metadata/#dfn-description-object" class="externalDFN">description object</a>.
          </dd>
          <dt><dfn>table group resource</dfn></dt><dd>
            The <a>table group resource</a> is a <a href="http://www.w3.org/TR/rdf11-concepts/#section-blank-nodes" class="externalDFN">blank node</a>
            used to identify the <a>table group description</a>.
          </dd>
          <dt><dfn>table description</dfn></dt><dd>
            The <a href="http://www.w3.org/TR/tabular-data-model/#dfn-table-description" class="externalDFN">table</a>
            <a href="http://www.w3.org/TR/tabular-metadata/#dfn-description-object" class="externalDFN">description object</a>
            associated with the <a>annotated table</a>.
          </dd>
          <dt><dfn>table resource</dfn></dt><dd>
            The <a>table resource</a> is a <a href="http://www.w3.org/TR/rdf11-concepts/#section-blank-nodes" class="externalDFN">blank node</a>
            used to identify the <a>table description</a>.
          </dd>
          <dt><dfn>schema description</dfn></dt><dd>
            The <a href="http://www.w3.org/TR/tabular-metadata/#dfn-schema-description" class="externalDFN">schema</a>
            <a href="http://www.w3.org/TR/tabular-metadata/#dfn-description-object" class="externalDFN">description object</a>
            for a <a>table description</a>.
          </dd>
          <dt><dfn>schema resource</dfn></dt><dd>
            The <a>schema resource</a> is a <a href="http://www.w3.org/TR/rdf11-concepts/#section-blank-nodes" class="externalDFN">blank node</a>
            used to identify the <a>schema description</a>.
          </dd>
          <dt><dfn>column description</dfn></dt><dd>
            A <a href="http://www.w3.org/TR/tabular-metadata/#dfn-column-description" class="externalDFN">column</a>
            <a href="http://www.w3.org/TR/tabular-metadata/#dfn-description-object" class="externalDFN">description object</a>
            of a <a>schema description</a> associated with a particular
            <a href="http://www.w3.org/TR/tabular-data-model/#dfn-column" class="externalDFN">column</a>.
          </dd>
          <dt><dfn>column resource</dfn></dt><dd>
            The <a>column resource</a> is a <a href="http://www.w3.org/TR/rdf11-concepts/#section-blank-nodes" class="externalDFN">blank node</a>
            used to identify the <a>column description</a>.
          </dd>
          <dt><dfn>aboutUrl</dfn></dt><dd>
            The <a>aboutUrl</a> is the evaluation of the <code>aboutUrl</code> property of the current
            <a href="http://www.w3.org/TR/tabular-data-model/#dfn-row" class="externalDFN">row</a>
            as defined in
            <cite><a href="http://www.w3.org/TR/tabular-metadata/#dfn-uri-template-property">URI template properties</a></cite>
            in [[!tabular-metadata]], or a
            <a href="http://www.w3.org/TR/rdf11-concepts/#section-blank-nodes" class="externalDFN">blank node</a>
            as defined in [[!rdf11-concepts]] if no <code>aboutUrl</code> exists.
          </dd>
          <dt><dfn>propertyUrl</dfn></dt><dd>
            The <a>propertyUrl</a> is the evaluation of the <code>propertyUrl</code> property of the current
            <a href="http://www.w3.org/TR/tabular-data-model/#dfn-row" class="externalDFN">row</a>
            as defined in
            <cite><a href="http://www.w3.org/TR/tabular-metadata/#dfn-uri-template-property">URI template properties</a></cite>
            in [[!tabular-metadata]].
          </dd>
          <dt><dfn>valueUrl</dfn></dt><dd>
            The <a>valueUrl</a> is the evaluation of the <code>valueUrl</code> property of the current
            <a href="http://www.w3.org/TR/tabular-data-model/#dfn-row" class="externalDFN">row</a>
            as defined in
            <cite><a href="http://www.w3.org/TR/tabular-metadata/#dfn-uri-template-property">URI template properties</a></cite>
            in [[!tabular-metadata]].
          </dd>
          <dt><dfn>common properties</dfn></dt><dd>
            The <a>common properties</a> of a metadata resource are defined in
            <a href="http://www.w3.org/TR/tabular-metadata/#common-properties">
              Section 3.3 Common Properties
            </a> of [[!tabular-metadata]]).
            The RDF values of these properties are the result of running the
            [[!json-ld-api]] <cite><a href="">toRdf</a></cite> algorithm over the
            resource <a>common properties</a> using the <a>table resource</a> as the
            subject.
          </dd>
          <dt><dfn>row resource</dfn></dt><dd>
            The <a>row resource</a> is the <a>aboutUrl</a> of the first column in the
            <a href="http://www.w3.org/TR/tabular-data-model/#dfn-row" class="externalDFN">row</a>.
          </dd>
        </dl>
      </section>
      <section id="map-annotated-tab-rdf">
        <h3>Generating RDF</h3>
        <section id="map-annotated-tab-table">
          <h4>Table-level processing</h4>
          <p>A conforming RDF processor MUST emit triples to the <a>output graph</a>
            conforming to those described in this algorithm.</p>
          
          <ol>
            <li>Emit the following triple defining the type of the <a>table resource</a>:
              <dl class="triple">
                <dt>subject</dt>
                <dd><a>table resource</a></dd>
                <dt>predicate</dt>
                <dd><code>rdf:type</code></dd>
                <dt>object</dt>
                <dd><code>csvw:Table</code></dd>
              </dl>
            </li>

            <li>Establish a new <a href="http://www.w3.org/TR/rdf11-concepts/#section-blank-nodes">blank node</a> <em>distribution</em> and emit the following triples:
              <dl class="triple">
                <dt>subject</dt>
                <dd><a>table resource</a></dd>
                <dt>predicate</dt>
                <dd><code>dcat:Distribution</code></dd>
                <dt>object</dt>
                <dd><em>distribution</em></dd>
              </dl>
              <dl class="triple">
                <dt>subject</dt>
                <dd><em>distribution</em></dd>
                <dt>predicate</dt>
                <dd><code>rdf:type</code></dd>
                <dt>object</dt>
                <dd><code>dcat:Distribution</code> </dd>
              </dl>
              <dl class="triple">
                <dt>subject</dt>
                <dd><em>distribution</em></dd>
                <dt>predicate</dt>
                <dd><code>dcat:downloadURL</code></dd>
                <dt>object</dt>
                <dd>absolute URL of the source CSV file</dd>
              </dl>
            </li>

            <li>
              <p>Where present in the <a>table description</a>,
                the following metadata properties SHALL be included in the
                <a>output graph</a> as properties of the 
                <a>table resource</a>:</p>
              <ul>
                <li>
                  <p><code>notes</code> - the array of entities representing structured annotations 
                    on the tabular data SHALL be included verbatim.</p>
                  <p class="note">The <a href="http://www.w3.org/annotation/">Web Annotation Working 
                    Group</a> is developing a vocabulary for expressing annotations which we anticipate 
                    referencing from this specification. Issues likely to be covered therein include: 
                    how to anchor the annotation to a target in the tabular data and/or CSV file, 
                    what form the annotations themselves may take (e.g. a simple literal annotation 
                    body, or whether additional formatting properties are required to indicate that 
                    the annotation is expressed in, say, Markdown or HTML).</p>
                  <div class="issue" data-number="71">
                    <p>Exact handling of annotations.</p> 
                    <p>Additionally, the mechanism to reference the annotation target (within tabular
                      data) is still unclear - especially given the confusion on identifying row
                      numbers (<a href="https://github.com/w3c/csvw/issues/68">ISSUE #68</a> refers).</p>
                  </div>
                </li>
                <li>
                  <p>Any <a>Common Properties</a>.</p>
                </li>
              </ul>  
            </li>

            <li>Emit the following triples for the <a>schema resource</a>
              <dl class="triple">
                <dt>subject</dt>
                <dd><a>table resource</a></dd>
                <dt>predicate</dt>
                <dd><code>csvw:tableSchema</code></dd>
                <dt>object</dt>
                <dd><a>schema resource</a></dd>
              </dl>
              <dl class="triple">
                <dt>subject</dt>
                <dd><a>schema resource</a></dd>
                <dt>predicate</dt>
                <dd><code>rdf:type</code></dd>
                <dt>object</dt>
                <dd><code>csvw:Schema</code></dd>
              </dl>
            </li>
            <li>
              For each <a>column description</a> in the <a>schema description</a>:
              <ul>
                <li>Emit the following triples for the <a>column resource</a>
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>schema resource</a></dd>
                    <dt>predicate</dt>
                    <dd><code>csvw:column</code></dd>
                    <dt>object</dt>
                    <dd><a>column resource</a></dd>
                  </dl>
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>column resource</a></dd>
                    <dt>predicate</dt>
                    <dd><code>rdf:type</code></dd>
                    <dt>object</dt>
                    <dd><code>csvw:Column</code></dd>
                  </dl>
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>column resource</a></dd>
                    <dt>predicate</dt>
                    <dd><code>csvw:colnum</code></dd>
                    <dt>object</dt>
                    <dd>column number of <a>column description</a> as an <code>xsd:integer</code></dd>
                  </dl>
                </li>
                <li>If the <code>aboutUrl</code> of the <a>column description</a> is not null, emit the following triple:
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>column resource</a></dd>
                    <dt>predicate</dt>
                    <dd><code>csvw:aboutUrl</code></dd>
                    <dt>object</dt>
                    <dd><code>aboutUrl</code> from the <a>column description</a></dd>
                  </dl>
                </li>
                <li>For all <code>propertyUrl</code> of the <a>column description</a> emit the following triples:
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>column resource</a></dd>
                    <dt>predicate</dt>
                    <dd><code>csvw:propertyUrl</code></dd>
                    <dt>object</dt>
                    <dd><code>propertyUrl</code> from the <a>column description</a></dd>
                  </dl>
                </li>
                <li>If the <code>valueUrl</code> of the <a>column description</a> is not null, emit the following triple:
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>column resource</a></dd>
                    <dt>predicate</dt>
                    <dd><code>csvw:valueUrl</code></dd>
                    <dt>object</dt>
                    <dd><code>valueUrl</code> from the <a>column description</a></dd>
                  </dl>
                </li>
                <li>
                  <p>For each value <code>title</code> a 
                    <a href="http://www.w3.org/TR/tabular-metadata/#dfn-natural-language-property" class="externalDFN">natural language property</a>,
                    emit the following triple:</p>
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>column resource</a></dd>
                    <dt>predicate</dt>
                    <dd><code>rdfs:label</code></dd>
                    <dt>object</dt>
                    <dd><em>value</em> (as a simple literal or language-tagged string)</dd>
                  </dl>
                  <p>The values of 
                    <a href="http://www.w3.org/TR/tabular-metadata/#dfn-natural-language-property" class="externalDFN">natural language properties</a>
                    are
                    <cite><a href="http://www.w3.org/TR/rdf11-concepts/#dfn-simple-literal" class="externalDFN">simple literals</a></cite> or
                    <cite><a href="http://www.w3.org/TR/rdf11-concepts/#dfn-language-tagged-string" class="externalDFN">language tagged strings</a></cite>,
                    depending on the column language (see [[!rdf-concepts]]); and</p>
                </li>
                <li>
                  <p>any <a>Common Properties</a>.</p>
                </li>
              </ul>
            </li>

            <li>For each <a href="http://www.w3.org/TR/tabular-data-model/#dfn-row" class="externalDFN">row</a>:
              <ul>
                <li>The <em>object</em> is the <a href="http://www.w3.org/TR/tabular-metadata/#dfn-cell-value" class="externalDFN">cell value</a> after applying datatype and format transformations
                  defined for the column as defined in [[!tabular-metadata]].</li>
                <li>Emit the following triples:
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>row resource</a></dd>
                    <dt>predicate</dt>
                    <dd><code>csvw:row</code></dd>
                    <dt>object</dt>
                    <dd><em>value</em> (as a simple literal or language-tagged string)</dd>
                  </dl>
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>row resource</a></dd>
                    <dt>predicate</dt>
                    <dd><code>csvw:rownum</code></dd>
                    <dt>object</dt>
                    <dd>row number of <a href="http://www.w3.org/TR/tabular-data-model/#dfn-row" class="externalDFN">row</a> as an <code>xsd:integer</code></dd>
                  </dl>
                </li>
                <li>If <em>object</em> is not <code>null</code>, then for each <em>object</em> <em>o</em> emit the following triple:
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>aboutUrl</a></dd>
                    <dt>predicate</dt>
                    <dd><a>propertyUrl</a></dd>
                    <dt>object</dt>
                    <dd><em>o</em></dd>
                  </dl>
                </li>
              </ul>
            </li>

            <li>
              <p>Optionally, the <a>output graph</a> MAY contain information
                describing how and when the <a>output graph</a> was created using terms from the PROV Ontology [[prov-o]].</p>
              <p>Let <em>provenance</em> be a new <a href="http://www.w3.org/TR/rdf11-concepts/#section-blank-nodes" class="externalDFN">blank node</a> and emit the following triples:</p>
              <dl class="triple">
                <dt>subject</dt>
                <dd><a>row resource</a></dd>
                <dt>predicate</dt>
                <dd><code>prov:activity</code></dd>
                <dt>object</dt>
                <dd><em>provenance</em></dd>
              </dl>
              <dl class="triple">
                <dt>provenance</dt>
                <dd><a>row resource</a></dd>
                <dt>predicate</dt>
                <dd><code>rdf:type</code></dd>
                <dt>object</dt>
                <dd><code>prov:Activity</code></dd>
              </dl>
              <p>
                Furthermore, if the metadata annotations are provided in one or
                more metadata documents (e.g. as
                <a>table description</a>, <a>schema description</a> and
                <a title="column description">column description</a>)
                then the provenance information SHOULD also include information
                about each of those metadata documents.</p>
              <p>The example below provides an illustration of <em>provenance information</em>, where <code><em>[CSV Location]</em></code> is the absolute URL of the source CSV file, <code><em>[Metadata Location]</em></code> is the location of the metadata document, <code><em>[Start Time]</em></code> is the start time of the mapping activity, <code><em>[End Time]</em></code> is the finish time of the mapping activity (both expressed as <code>xsd:dateTime</code>) and <code><em>[RDF Output Location]</em></code> is the location of the generated <a>output graph</a>.</p>

              <pre class="example" id="map-annotated-tab-example-prov" title="Provenance information">
&lt;&gt; a csvw:Table;
  prov:activity [
    a prov:Activity;
    prov:startedAtTime [Start Time];
    prov:endedAtTime [End Time];
    prov:generated &lt;[RDF Output Location]&gt;;
    prov:qualifiedUsage [
      a prov:Usage ;
      prov:Entity &lt;[CSV Location]&gt; ;
      prov:hadRole csvw:csvEncodedTabularData
    ];
    prov:qualifiedUsage [
      a prov:Usage ;
      prov:Entity &lt;[Metadata Location]&gt; ;
      prov:hadRole csvw:tabularMetadata
    ]
  ];
  ...
              </pre>

            </li>

          </ol>
        </section>

      </section>

      <section id="map-annotated-tab-examples">
        <h3>Examples</h3>
        <p class="issue" data-number="">These examples don't really show the edge cases - 
          probably need to rework them</p>
        <p>The first example illustrates how a CSV file with metadata annotations drawn <em>only</em> 
          from a <a href="http://www.w3.org/TR/tabular-data-model/#dfn-header-line" class="externalDFN">header line</a> is 
          processed. The tabular data describes lists countries, giving their country code and name.
          There are two columns, named <code>country</code> and <code>name</code>, and four rows.</p>

        <table style="width: 30%">
          <tr>
            <th>country </th>
            <th>name</th>
          </tr>
          <tr>
            <td>AD</td>
            <td>Andorra</td>
          </tr>
          <tr>
            <td>AF</td>
            <td>Afghanistan</td>
          </tr>
          <tr>
            <td>AI</td>
            <td>Anguilla</td>
          </tr>
          <tr>
            <td>AL</td>
            <td>Albania</td>
          </tr>
        </table>

        <p>The CSV input (published at <code>http://example.org/country-codes-and-names.csv</code>):</p>

        <pre class="example" id="map-annotated-tab-examples-1-input" title="CSV input ">
country,name
AD,Andorra
AF,Afghanistan
AI,Anguilla
AL,Albania
        </pre>

        <p>The resulting RDF output graph (published to <code>http://example.org/country-codes-and-names.ttl</code>):</p>

        <pre class="example" id="map-annotated-tab-examples-1-output" title="RDF output (Turtle syntax)">
@prefix :     &lt;http://example.org/country-codes-and-names.csv#&gt; .
@prefix csvw: &lt;http://www.w3.org/ns/csvw#&gt; .
@prefix dcat: &lt;http://www.w3.org/ns/dcat#&gt; .
@prefix prov: &lt;http://www.w3.org/ns/prov#&gt; .
@prefix rdf:  &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
@prefix xsd:  &lt;http://www.w3.org/2001/XMLSchema#&gt; .

:country a rdf:Property ;
  rdfs:label "country" .

:name a rdf:Property ;
  rdfs:label "name" .

:table a csvw:Table ;
  dcat:distribution [
    a dcat:Distribution ;
    dcat:downloadURL &lt;http://example.org/country-codes-and-names.csv&gt; 
  ] ;
  csvw:row [
    :country "AD" ;
    :name "Andorra" ;
  ] , [
    :country "AF" ;
    :name "Afghanistan" ;
  ] , [
    :country "AI" ;
    :name "Anguilla" ;
  ] , [
    :country "AL" ;
    :name "Albania" ;
  ] ;
  prov:activity [
    a prov:Activity ;
    prov:startedAtTime "2014-12-16T12:15:06"^^xsd:dateTime ;
    prov:endedAtTime "2014-12-16T12:15:07"^^xsd:dateTime ;
    prov:generated &lt;http://example.org/country-codes-and-names.ttl&gt; ;
    prov:qualifiedUsage [
      a prov:Usage ;
      prov:Entity &lt;http://example.org/country-codes-and-names.csv&gt; ;
      prov:hadRole csvw:csvEncodedTabularData ;
    ] ;
  ] ;
  .
        </pre>

        <div class="issue" data-number="116">
          <p>In the example output above we see Turtle's shorthand
            syntax for dealing with blank nodes. Should the recommended output form explicitly
            identify the blank nodes using the row number? e.g.</p>
          <p><code>&nbsp;&nbsp;csvw:row _:1 , _:2 , _:3 , _:4 .</code></p>
          <p><code>&nbsp;&nbsp;_:1 :country "AD" ; :name "Andorra" .</code></p>
          <p>etc.</p>
        </div>

        <p>The second example illustrates how the mapping is modified with the addition of metadata
          annotations in a metadata document. The CSV file is a small extract from a much larger
          Tree Inventory dataset from the City of Palo Alto which supports the maintaining and 
          tracking the city's public trees and urban forest. There are five columns, named 
          <code>GID</code>, <code>On Street</code>, <code>Species</code>, <code>Trim Cycle</code> 
          and <code>Inventory Date</code>, and three rows.</p>

        <table style="width:80%">
          <tr>
            <th>GID</th>
            <th>On Street</th>
            <th>Species</th>
            <th>Trim Cycle</th>
            <th>Inventory Date</th>
          </tr>
          <tr>
            <td>1</td>
            <td>ADDISON AV</td>
            <td>Celtis australis</td>
            <td>Large Tree Routine Prune</td>
            <td>10/18/2010</td>
          </tr>
          <tr>
            <td>2</td>
            <td>EMERSON ST</td>
            <td>Liquidambar styraciflua</td>
            <td>Large Tree Routine Prune</td>
            <td>6/2/2010</td>
          </tr>
          <tr>
            <td>3</td>
            <td>EMERSON ST</td>
            <td>Liquidambar styraciflua</td>
            <td>Large Tree Routine Prune</td>
            <td>6/2/2010</td>
          </tr>
        </table>

        <p>The CSV input (published at <code>http://example.org/tree-ops.csv</code>):</p>

        <pre class="example" id="map-annotated-tab-examples-2-input" title="CSV input ">
GID,On Street,Species,Trim Cycle,Inventory Date
1,ADDISON AV,Celtis australis,Large Tree Routine Prune,10/18/2010
2,EMERSON ST,Liquidambar styraciflua,Large Tree Routine Prune,6/2/2010
3,EMERSON ST,Liquidambar styraciflua,Large Tree Routine Prune,6/2/2010
        </pre>

        <p>The metadata description (published at <code>http://example.org/tree-ops.csv-metadata.json</code>):</p>

        <pre class="example" id="map-annotated-tab-examples-2-metadata" title="Metadata description">
{
  "@context": ["http://www.w3.org/ns/csvw", {"@language": "en"}],
  "url": "tree-ops",
  "dcat:distribution": {
    "dcat:downloadURL": "tree-ops.csv"
  }
  "dc:title": "Tree Operations",
  "dc:keywords": ["tree", "street", "maintenance"],
  "dc:publisher": [{
    "schema:name": "Example Municipality",
    "schema:web": "http://example.org"
  }],
  "dc:license": "http://opendefinition.org/licenses/cc-by/",
  "dc:modified": {
    "@value": "2010-12-31",
    "@type": "http://www.w3.org/2001/XMLSchema#date"
  }
  "tableSchema": {
    "columns": [{
      "name": "GID",
      "title": [
        "GID",
        "Generic Identifier"
      ],
      "dc:description": "An identifier for the operation on a tree.",
      "datatype": "string",
      "required": true,
      "unique": true
    }, {
      "name": "on-street",
      "title": "On Street",
      "dc:description": "The street that the tree is on.",
      "datatype": "string"
    }, {
      "name": "species",
      "title": "Species",
      "dc:description": "The species of the tree.",
      "datatype": "string"
    }, {
      "name": "trim-cycle",
      "title": "Trim Cycle",
      "dc:description": "The operation performed on the tree.",
      "datatype": "string"
    }, {
      "name": "inventory-date",
      "title": "Inventory Date",
      "dc:description": "The date of the operation that was performed.",
      "datatype": "date"
      "format": {
        "picture-strings": [
          "unicode": "M/d/yyyy"
        ]
      }
    }]
    "primaryKey": "GID",  
    "urlTemplate": "#gid-{GID}"
  }
}
        </pre>

        <p>The resulting RDF output graph (published to <code>http://example.org/tree-ops.ttl</code>):</p>

        <pre class="example" id="map-annotated-tab-examples-2-output" title="RDF output (Turtle syntax)">
@prefix :       &lt;http://example.org/tree-ops.csv#&gt; .
@prefix csvw:   &lt;http://www.w3.org/ns/csvw#&gt; .
@prefix dc:     &lt;http://purl.org/dc/terms/&gt;
@prefix dcat:   &lt;http://www.w3.org/ns/dcat#&gt; .
@prefix prov:   &lt;http://www.w3.org/ns/prov#&gt; .
@prefix rdf:    &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix rdfs:   &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
@prefix schema: &lt;http://schema.org/&gt;
@prefix xsd:    &lt;http://www.w3.org/2001/XMLSchema#&gt; .

:GID a rdf:Property ;
  rdfs:label "GID" , "GID" , "Generic Identifier" ;
  dc:description "An identifier for the operation on a tree." .

:on-street a rdf:Property ;
  rdfs:label "On Street" , "On Street" ;
  dc:description "The street that the tree is on." .

:species a rdf:Property ;
  rdfs:label "Species" , "Species" ;
  dc:description "The species of the tree." .

:trim-cycle a rdf:Property ;
  rdfs:label "Trim Cycle" , "Trim Cycle" ;
  dc:description "The operation performed on the tree." .

:inventory-date a rdf:Property ;
  rdfs:label "Inventory Date" , "Inventory Date" ;
  dc:description "The date of the operation that was performed." .

:table a csvw:Table ;
  dcat:distribution [
    a dcat:Distribution ;
    dcat:downloadURL &lt;http://example.org/tree-ops.csv&gt; 
  ] ;
  dc:title "Tree Operations" ;
  dc:keywords "tree" , "street", "maintenance" ;
  dc:publisher [
    schema:name "Example Municipality" ;
    schema:web "http://example.org"
  ] ;
  dc:license &lt;http://opendefinition.org/licenses/cc-by/&gt; ;
  dc:modified "2010-12-31"^^xsd:date ;
  csvw:row :gid-1 , :gid-2 , :gid-3 ;
  prov:activity [
    a prov:Activity ;
    prov:startedAtTime "2014-12-16T12:15:06"^^xsd:dateTime ;
    prov:endedAtTime "2014-12-16T12:15:07"^^xsd:dateTime ;
    prov:generated &lt;http://example.org/tree-ops.ttl&gt; ;
    prov:qualifiedUsage [
      a prov:Usage ;
      prov:Entity &lt;http://example.org/tree-ops.csv&gt; ;
      prov:hadRole csvw:csvEncodedTabularData 
    ] ;
    prov:qualifiedUsage [
      a prov:Usage ;
      prov:Entity &lt;http://example.org/tree-ops.csv-metadata.json&gt; ;
      prov:hadRole csvw:tabularMetadata 
    ] ;
  ] ;
  .

:gid-1
  :GID "1"^^xsd:string ;
  :on-street "ADDISON AV"^^xsd:string ;
  :species "Celtis australis"^^xsd:string ;
  :trim-cycle "Large Tree Routine Prune"^^xsd:string ;
  :inventory-date "2010-10-18"^^xsd:date ;
  .

:gid-2
  :GID "2"^^xsd:string ;
  :on-street "EMERSON ST"^^xsd:string ;
  :species "Liquidambar styraciflua"^^xsd:string ;
  :trim-cycle "Large Tree Routine Prune"^^xsd:string ;
  :inventory-date "2010-06-02"^^xsd:date ;
  .

:gid-3
  :GID "3"^^xsd:string ;
  :on-street "EMERSON ST"^^xsd:string ;
  :species "Liquidambar styraciflua"^^xsd:string ;
  :trim-cycle "Large Tree Routine Prune"^^xsd:string ;
  :inventory-date "2010-06-02"^^xsd:date ;
  .
        </pre>

        <p class="note">In the example RDF output note that the value of column <code>Inventory Date</code>
          has been amended from format <code>M/d/yyyy</code> (as described by the 
          <a href="http://www.unicode.org/reports/tr35/tr35-dates.html#Date_Format_Patterns">
          Unicode Date Format Pattern</a> string [[!tr35]]) into an [[!iso8601]] formatted
          date string compliant with <code>xsd:date</code> syntax.</p>

        <p class="issue" data-number="">Note the repeating <code>rdfs:label</code> for the column predicates; 
          this is because the CSV and the metadata both include the same <code>title</code> - should the
          mapping application attempt to deduplicate?</p>

        <p class="issue" data-number="">The assertions about the column properties could
          include <code>rdfs:range</code> to specify the data type. Is this desirable?</p>

      </section>

    </section>

    <section id="map-grouped-tab">
    
      <h2>Mapping Grouped Tabular Data</h2>
    
        <p>The procedures and rules for mapping a collection of tabular data compliant with the
          <a href="http://www.w3.org/TR/tabular-data-model/#dfn-grouped-tabular-data-model" class="externalDFN">
          grouped tabular data model</a> are described below.</p>
    
        <p>The metadata for a <a href="http://www.w3.org/TR/tabular-data-model/#dfn-group-of-tables" class="externalDFN">
          group of tables</a> SHALL be provided by a
          <a href="http://www.w3.org/TR/tabular-metadata/#dfn-table-group-description" class="externalDFN">
          table group description</a> (as defined in [[!tabular-metadata]]) within the 
          associated metadata document.</p>
      
      <section id="map-grouped-tab-rdf">
        
        <h3>Generating RDF</h3>
        
        <section id="map-grouped-tab-table">
          
          <h4>Group-level processing</h4>
          <p>A conforming RDF processor MUST emit triples to the <a>output graph</a>
            conforming to those described in this algorithm.</p>
          
          <ol>
            <li>Emit the following triple defining the type of the <a>table resource</a>:
              <dl class="triple">
                <dt>subject</dt>
                <dd><a>table group resource</a></dd>
                <dt>predicate</dt>
                <dd><code>rdf:type</code></dd>
                <dt>object</dt>
                <dd><code>csvw:TableGroup</code></dd>
              </dl>
            </li>

            <li>
              <p>Where present in the <a>table group description</a>,
                the following metadata properties SHALL be included in the
                <a>output graph</a> as properties of the 
                <a>table group resource</a>:</p>
              <ul>
                <li>
                  <p><code>notes</code> - the array of entities representing structured annotations 
                    on the tabular data SHALL be included verbatim.</p>
                  <p class="note">The <a href="http://www.w3.org/annotation/">Web Annotation Working 
                    Group</a> is developing a vocabulary for expressing annotations which we anticipate 
                    referencing from this specification. Issues likely to be covered therein include: 
                    how to anchor the annotation to a target in the tabular data and/or CSV file, 
                    what form the annotations themselves may take (e.g. a simple literal annotation 
                    body, or whether additional formatting properties are required to indicate that 
                    the annotation is expressed in, say, Markdown or HTML).</p>
                  <div class="issue" data-number="71">
                    <p>Exact handling of annotations.</p> 
                    <p>Additionally, the mechanism to reference the annotation target (within tabular
                      data) is still unclear - especially given the confusion on identifying row
                      numbers (<a href="https://github.com/w3c/csvw/issues/68">ISSUE #68</a> refers).</p>
                  </div>
                </li>
                <li>
                  <p>Any <a>Common Properties</a>.</p>
                </li>
              </ul>  
            </li>
            <li>
              For each <a>table description</a> which is a value of <code>resources</code>
              in the <a>table group description</a>, perform the following steps:
              <ol>
                <li>Emit the following triple:
                  <dl class="triple">
                    <dt>subject</dt>
                    <dd><a>table group resource</a></dd>
                    <dt>predicate</dt>
                    <dd><code>csvw:table</code></dd>
                    <dt>object</dt>
                    <dd><a>table resource</a></dd>
                  </dl>
                </li>
                  <li>Perform <a href="#map-annotated-tab-table" class="sectionRef">Table-level processing</a>
                    using <a>table resource</a>.</li>
              </ol>
            </li>
          </ol>
          
          <p class="issue" data-number="">The presence of foreign-key references within the table 
            descriptions may affect the way the data is packaged in the output graph. Reviewers are 
            invited to comment on how grouped tabular data with foreign-key references might best be 
            organised.</p>
        
        </section>
      
      </section>
      
      <section id="map-grouped-tab-examples">
        
        <h3>Examples</h3>
        
        <p class="TBD"><a href="http://www.w3.org/TR/csvw-ucr/#UC-OrganogramData">
          Use Case 4: Publication of public sector roles and salaries</a> likely provides a good 
          source of material for these examples. To be added.</p>
      
      </section>
    
    </section>

  </body>
</html>
